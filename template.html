<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CreditCow Sync</title>
    <style>
      h1 { font-family: 'Courier New', Courier, monospace; margin: 0; }
      h1.primary { height: 10vh; display: flex; align-items: center; justify-content: center; font-size: 6vh; }
      h1.secondary { height: 5vh; display: flex; align-items: center; justify-content: center; font-size: 3vh; }
      .controls { margin: 12px 0; text-align: center; }
    </style>
</head>
<body>
    
    <h1 class="primary">DEBUG's CreditCow</h1>
    <h1 class="secondary">Your public receiver ID: 1</h1>

    <div class="controls">
      <button id="btn-add">Add 1 to send</button>
      <button id="btn-subtract">Subtract 1 from send</button>
    </div>

    <h1 id="output-area1" class="secondary">0</h1>
    
    <div style="text-align: center;">
      <label for="sendID">sendID:</label>
      <input type="text" id="sendID" placeholder="Target ID">
      <button id="submitBtn" type="button">Submit & Sync</button>
    </div>

  <script>
    // 1. Global Variables
    let sendTotal = 0;
    const btnSubmit = document.getElementById('submitBtn');
    const inputID = document.getElementById('sendID'); // Fixed ID to match HTML
    const out = document.getElementById("output-area1");
    const btnSub = document.getElementById("btn-subtract");

    // 2. Display Logic
    function updateDisplay() {
      out.textContent = sendTotal;
      btnSub.disabled = sendTotal <= 0;
    }

    document.getElementById("btn-add").addEventListener("click", () => {
      sendTotal++;
      updateDisplay();
    });

    btnSub.addEventListener("click", () => {
      if (sendTotal > 0) {
        sendTotal--;
        updateDisplay();
      }
    });

    // 3. GitHub Sync Logic
    async function subtractAndSync(targetID) {
      const GITHUB_TOKEN = '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'; 
      const OWNER = 'coolgames555';
      const REPO = 'CreditCow';
      const PATH = `data/${targetID}.txt`; // Use backticks for interpolation
    const url = `https://api.github.com/repos/${OWNER}/${REPO}/${PATH}`;


      try {
        const response = await fetch(url, {
          headers: { Authorization: `Bearer ${GITHUB_TOKEN}` }
        });
        
        if (!response.ok) throw new Error("File not found on GitHub");
        const fileData = await response.json();

        const currentVal = parseFloat(atob(fileData.content)); 
        const newVal = (currentVal + sendTotal).toString(); 

        const updateRes = await fetch(url, {
          method: 'PUT',
          headers: {
            Authorization: `Bearer ${GITHUB_TOKEN}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            message: `Subtracted ${sendTotal} from ${targetID}`,
            content: btoa(newVal),
            sha: fileData.sha
          })
        });

        if (updateRes.ok) {
          alert(`Success! New value for ${targetID}: ${newVal}`);
        }
      } catch (error) {
        console.error("Error:", error);
        alert("Sync failed: " + error.message);
      }
    }

    // 4. Submit Trigger
    btnSubmit.addEventListener('click', function() {
      const ID = inputID.value.trim();
      if (!ID) return alert("Please enter a Target ID");
      subtractAndSync(ID);
    });

    updateDisplay();
  </script>
</body>
</html>
